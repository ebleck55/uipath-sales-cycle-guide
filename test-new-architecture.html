<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>New Architecture Validation Test</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold mb-6">🧪 New Architecture Validation Test</h1>
    
    <!-- Test Results -->
    <div class="grid md:grid-cols-2 gap-6 mb-8">
      <!-- Old System (Hardened Branch) -->
      <div class="bg-white p-6 rounded-lg shadow">
        <h2 class="text-xl font-semibold mb-4 text-blue-700">
          📊 Old System (Current Hardened Branch)
        </h2>
        <div id="old-system-results" class="space-y-4">
          <p class="text-gray-500">Loading old system data...</p>
        </div>
      </div>
      
      <!-- New System (Architecture Branch) -->
      <div class="bg-white p-6 rounded-lg shadow">
        <h2 class="text-xl font-semibold mb-4 text-green-700">
          🚀 New System (New Architecture)
        </h2>
        <div id="new-system-results" class="space-y-4">
          <p class="text-gray-500">Loading new system data...</p>
        </div>
      </div>
    </div>

    <!-- Comparison Tests -->
    <div class="bg-white p-6 rounded-lg shadow mb-6">
      <h3 class="text-lg font-semibold mb-4">🔬 Validation Tests</h3>
      <div class="grid md:grid-cols-3 gap-4">
        <button onclick="testBankingPersonas()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
          Test Banking Personas
        </button>
        <button onclick="testInsurancePersonas()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
          Test Insurance Personas
        </button>
        <button onclick="testTagFiltering()" class="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700">
          Test Tag Filtering
        </button>
      </div>
    </div>

    <!-- Test Log -->
    <div class="bg-gray-50 p-6 rounded-lg">
      <h3 class="text-lg font-semibold mb-4">📋 Test Log</h3>
      <div id="test-log" class="space-y-2 max-h-64 overflow-y-auto">
        <p class="text-gray-600 text-sm">Test results will appear here...</p>
      </div>
    </div>
  </div>

  <!-- Load old system data -->
  <script src="js/data.js"></script>
  
  <!-- Load new system API -->
  <script src="src/api/contentAPI.js"></script>

  <script>
    let contentAPI;
    let oldSystemData = {};
    let testResults = [];

    // Initialize systems
    document.addEventListener('DOMContentLoaded', async () => {
      logTest('🚀 Initializing architecture validation test...');
      
      // Initialize new system
      contentAPI = new ContentAPI();
      
      // Load old system data
      if (window.SALES_CYCLE_DATA && SALES_CYCLE_DATA.personas) {
        oldSystemData = SALES_CYCLE_DATA.personas;
        displayOldSystemData();
        logTest('✅ Old system data loaded successfully');
      } else {
        logTest('❌ Could not load old system data');
      }
      
      // Test new system
      try {
        const newPersonas = await contentAPI.getPersonas();
        displayNewSystemData(newPersonas);
        logTest('✅ New system data loaded successfully');
      } catch (error) {
        logTest('❌ New system failed to load: ' + error.message);
      }
      
      logTest('Ready for testing! Use the buttons above to run validation tests.');
    });

    function displayOldSystemData() {
      const container = document.getElementById('old-system-results');
      const bankingCount = oldSystemData.banking ? oldSystemData.banking.length : 0;
      const insuranceCount = oldSystemData.insurance ? oldSystemData.insurance.length : 0;
      
      container.innerHTML = `
        <div class="text-sm space-y-2">
          <div class="flex justify-between">
            <span>Banking Personas:</span>
            <span class="font-semibold">${bankingCount}</span>
          </div>
          <div class="flex justify-between">
            <span>Insurance Personas:</span>
            <span class="font-semibold">${insuranceCount}</span>
          </div>
          <div class="flex justify-between">
            <span>Total Personas:</span>
            <span class="font-semibold">${bankingCount + insuranceCount}</span>
          </div>
          <div class="mt-4">
            <h4 class="font-medium mb-2">Sample Banking Personas:</h4>
            <ul class="list-disc list-inside text-xs space-y-1">
              ${(oldSystemData.banking || []).slice(0, 3).map(p => `<li>${p.title}</li>`).join('')}
            </ul>
          </div>
        </div>
      `;
    }

    function displayNewSystemData(personas) {
      const container = document.getElementById('new-system-results');
      const bankingPersonas = personas.filter(p => p.vertical === 'banking');
      const insurancePersonas = personas.filter(p => p.vertical === 'insurance');
      
      container.innerHTML = `
        <div class="text-sm space-y-2">
          <div class="flex justify-between">
            <span>Banking Personas:</span>
            <span class="font-semibold">${bankingPersonas.length}</span>
          </div>
          <div class="flex justify-between">
            <span>Insurance Personas:</span>
            <span class="font-semibold">${insurancePersonas.length}</span>
          </div>
          <div class="flex justify-between">
            <span>Total Personas:</span>
            <span class="font-semibold">${personas.length}</span>
          </div>
          <div class="mt-4">
            <h4 class="font-medium mb-2">Sample Banking Personas:</h4>
            <ul class="list-disc list-inside text-xs space-y-1">
              ${bankingPersonas.slice(0, 3).map(p => `<li>${p.title}</li>`).join('')}
            </ul>
          </div>
          <div class="mt-4">
            <h4 class="font-medium mb-2">New Features:</h4>
            <ul class="list-disc list-inside text-xs space-y-1">
              <li>✅ Tagging System</li>
              <li>✅ LOB Mapping</li>
              <li>✅ Influence Levels</li>
              <li>✅ Priority Scoring</li>
            </ul>
          </div>
        </div>
      `;
    }

    async function testBankingPersonas() {
      logTest('🏦 Testing banking personas comparison...');
      
      const oldBanking = oldSystemData.banking || [];
      const newBanking = await contentAPI.getPersonas('banking');
      
      logTest(`Old system: ${oldBanking.length} banking personas`);
      logTest(`New system: ${newBanking.length} banking personas`);
      
      if (oldBanking.length === newBanking.length) {
        logTest('✅ Banking persona counts match!');
      } else {
        logTest('❌ Banking persona counts differ!');
      }
      
      // Test content matching
      let contentMatches = 0;
      oldBanking.forEach(oldPersona => {
        const newPersona = newBanking.find(np => np.title === oldPersona.title);
        if (newPersona && newPersona.world === oldPersona.world) {
          contentMatches++;
        }
      });
      
      logTest(`Content matches: ${contentMatches}/${oldBanking.length} personas`);
      if (contentMatches === oldBanking.length) {
        logTest('✅ All banking persona content matches!');
      }
    }

    async function testInsurancePersonas() {
      logTest('🏥 Testing insurance personas comparison...');
      
      const oldInsurance = oldSystemData.insurance || [];
      const newInsurance = await contentAPI.getPersonas('insurance');
      
      logTest(`Old system: ${oldInsurance.length} insurance personas`);
      logTest(`New system: ${newInsurance.length} insurance personas`);
      
      if (oldInsurance.length === newInsurance.length) {
        logTest('✅ Insurance persona counts match!');
      } else {
        logTest('❌ Insurance persona counts differ!');
      }
    }

    async function testTagFiltering() {
      logTest('🏷️  Testing new tag filtering capabilities...');
      
      // Test operations filtering
      const operationsPersonas = await contentAPI.getPersonasByTags(['operations']);
      logTest(`Found ${operationsPersonas.length} personas with 'operations' tag`);
      
      // Test compliance filtering  
      const compliancePersonas = await contentAPI.getPersonasByTags(['compliance']);
      logTest(`Found ${compliancePersonas.length} personas with 'compliance' tag`);
      
      // Test LOB filtering
      const paymentPersonas = await contentAPI.getPersonasByLOB('payments');
      logTest(`Found ${paymentPersonas.length} personas for payments LOB`);
      
      // Test influence filtering
      const decisionMakers = await contentAPI.getPersonasByInfluence('decision-maker');
      logTest(`Found ${decisionMakers.length} decision-maker personas`);
      
      logTest('✅ Tag filtering system is working!');
    }

    function logTest(message) {
      const testLog = document.getElementById('test-log');
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.className = 'text-sm p-2 bg-white rounded border';
      
      // Color code based on message type
      if (message.includes('✅')) {
        logEntry.classList.add('border-green-200', 'bg-green-50');
      } else if (message.includes('❌')) {
        logEntry.classList.add('border-red-200', 'bg-red-50');
      } else if (message.includes('🧪') || message.includes('🔬')) {
        logEntry.classList.add('border-blue-200', 'bg-blue-50');
      }
      
      logEntry.innerHTML = `<span class="text-gray-400">[${timestamp}]</span> ${message}`;
      testLog.appendChild(logEntry);
      testLog.scrollTop = testLog.scrollHeight;
    }
  </script>
</body>
</html>