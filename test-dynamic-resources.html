<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dynamic Resources Filtering Test</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
  <div class="max-w-7xl mx-auto">
    <h1 class="text-3xl font-bold mb-6">Dynamic Resources Filtering Test</h1>
    
    <!-- Customer Information Selectors -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
      <!-- Vertical Selector -->
      <div class="bg-white p-4 rounded-lg shadow">
        <h3 class="font-semibold mb-3">Vertical</h3>
        <div class="space-y-2">
          <button class="industry-btn w-full px-3 py-2 text-sm font-medium rounded-md border-2 border-gray-200 transition-colors hover:border-gray-300" data-industry="">
            Clear Selection
          </button>
          <button class="industry-btn w-full px-3 py-2 text-sm font-medium rounded-md border-2 border-gray-200 transition-colors hover:border-gray-300" data-industry="banking">
            Banking
          </button>
          <button class="industry-btn w-full px-3 py-2 text-sm font-medium rounded-md border-2 border-gray-200 transition-colors hover:border-gray-300" data-industry="insurance">
            Insurance
          </button>
        </div>
      </div>

      <!-- LOB Selector -->
      <div class="bg-white p-4 rounded-lg shadow">
        <h3 class="font-semibold mb-3">Line of Business</h3>
        <select id="lob-selector" class="w-full px-3 py-2 text-sm bg-white border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
          <option value="">Loading...</option>
        </select>
      </div>

      <!-- Customer Type -->
      <div class="bg-white p-4 rounded-lg shadow">
        <h3 class="font-semibold mb-3">Customer Type</h3>
        <div class="space-y-2">
          <button class="customer-type-btn w-full px-3 py-2 text-sm font-medium rounded-md border-2 border-gray-200 transition-colors hover:border-gray-300" data-type="new-logo">
            New Logo
          </button>
          <button class="customer-type-btn w-full px-3 py-2 text-sm font-medium rounded-md border-2 border-gray-200 transition-colors hover:border-gray-300" data-type="existing">
            Existing
          </button>
        </div>
      </div>

      <!-- Deployment -->
      <div class="bg-white p-4 rounded-lg shadow">
        <h3 class="font-semibold mb-3">Deployment</h3>
        <select id="deployment-type" class="w-full px-3 py-2 text-sm bg-white border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
          <option value="">Select Deployment</option>
          <option value="on-prem">On-Premises</option>
          <option value="automation-suite">Automation Suite</option>
          <option value="automation-cloud">Automation Cloud</option>
        </select>
      </div>
    </div>

    <!-- Test Scenarios -->
    <div class="bg-white p-6 rounded-lg shadow mb-8">
      <h2 class="text-xl font-semibold mb-4">Quick Test Scenarios</h2>
      <div class="grid md:grid-cols-4 gap-4">
        <button onclick="testCapitalMarketsResources()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
          Capital Markets
        </button>
        <button onclick="testInsuranceClaimsResources()" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
          Insurance Claims
        </button>
        <button onclick="testGeneralFinanceResources()" class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700">
          General Finance
        </button>
        <button onclick="testCloudDeploymentContext()" class="px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700">
          Cloud Context
        </button>
      </div>
    </div>

    <!-- Resources Display Container -->
    <div class="bg-white p-6 rounded-lg shadow mb-8">
      <div id="resources-container">
        <!-- Resources will be rendered here -->
        <p class="text-gray-500 text-center py-8">Select customer criteria above to see relevant resources...</p>
      </div>
    </div>

    <!-- Expected Results Guide -->
    <div class="grid md:grid-cols-2 gap-6 mb-8">
      <div class="bg-blue-50 p-6 rounded-lg">
        <h3 class="text-lg font-semibold text-blue-900 mb-4">Expected Banking Resources</h3>
        <div class="space-y-2 text-sm">
          <div><strong>Capital Markets:</strong> Trade Settlement Guide, Regulatory Reporting, Client Onboarding Kit</div>
          <div><strong>Consumer Banking:</strong> ROI Calculator, Loan Automation Playbook, Customer Onboarding Templates</div>
          <div><strong>Commercial Banking:</strong> Commercial Credit Assessment Automation</div>
          <div><strong>Wealth Management:</strong> Portfolio Rebalancing Automation</div>
        </div>
      </div>
      
      <div class="bg-green-50 p-6 rounded-lg">
        <h3 class="text-lg font-semibold text-green-900 mb-4">Expected Insurance Resources</h3>
        <div class="space-y-2 text-sm">
          <div><strong>Property & Casualty:</strong> Claims Processing Accelerator, AI Fraud Detection Suite</div>
          <div><strong>Claims Processing:</strong> Intelligent Claims Triage, Investigation Toolkit</div>
          <div><strong>Underwriting:</strong> Automated Underwriting Engine, Risk Assessment Models</div>
          <div><strong>Life & Annuities:</strong> Policy Administration Automation</div>
        </div>
      </div>
    </div>

    <!-- Test Log -->
    <div class="bg-gray-50 p-6 rounded-lg">
      <h3 class="text-lg font-semibold mb-4">Test Log & Results</h3>
      <div id="test-log" class="space-y-2 max-h-64 overflow-y-auto">
        <p class="text-gray-600 text-sm">Test log will appear here...</p>
      </div>
    </div>
  </div>

  <!-- Include the resources functionality from main app -->
  <script src="timeline-app.js"></script>

  <script>
    let testManager;

    // Test functions
    function testCapitalMarketsResources() {
      logTest('Testing Capital Markets Resources scenario...');
      
      // Select Banking vertical
      const bankingBtn = document.querySelector('[data-industry="banking"]');
      if (bankingBtn) {
        bankingBtn.click();
        setTimeout(() => {
          // Select Capital Markets LOB
          const lobSelector = document.getElementById('lob-selector');
          lobSelector.value = 'capital-markets';
          lobSelector.dispatchEvent(new Event('change'));
          
          setTimeout(() => {
            // Select cloud deployment to see deployment context
            const deploymentSelector = document.getElementById('deployment-type');
            deploymentSelector.value = 'automation-cloud';
            deploymentSelector.dispatchEvent(new Event('change'));
            
            logTest('✅ Capital Markets test completed. Expected: 3 resources with trade settlement, regulatory reporting, and client onboarding.');
          }, 100);
        }, 100);
      }
    }

    function testInsuranceClaimsResources() {
      logTest('Testing Insurance Claims Resources scenario...');
      
      // Select Insurance vertical
      const insuranceBtn = document.querySelector('[data-industry="insurance"]');
      if (insuranceBtn) {
        insuranceBtn.click();
        setTimeout(() => {
          // Select Claims Processing LOB
          const lobSelector = document.getElementById('lob-selector');
          lobSelector.value = 'claims-processing';
          lobSelector.dispatchEvent(new Event('change'));
          
          setTimeout(() => {
            // Select existing customer to see customer context
            const existingBtn = document.querySelector('[data-type="existing"]');
            if (existingBtn) existingBtn.click();
            
            logTest('✅ Insurance Claims test completed. Expected: 2 resources with claims triage and investigation toolkit.');
          }, 100);
        }, 100);
      }
    }

    function testGeneralFinanceResources() {
      logTest('Testing General Finance Resources scenario...');
      
      // Clear vertical selection
      const clearBtn = document.querySelector('[data-industry=""]');
      if (clearBtn) {
        clearBtn.click();
        setTimeout(() => {
          // Select Finance LOB
          const lobSelector = document.getElementById('lob-selector');
          lobSelector.value = 'finance';
          lobSelector.dispatchEvent(new Event('change'));
          
          setTimeout(() => {
            // Select on-prem deployment
            const deploymentSelector = document.getElementById('deployment-type');
            deploymentSelector.value = 'on-prem';
            deploymentSelector.dispatchEvent(new Event('change'));
            
            logTest('✅ General Finance test completed. Expected: 3 resources with month-end close, AP automation, and financial reporting.');
          }, 100);
        }, 100);
      }
    }

    function testCloudDeploymentContext() {
      logTest('Testing Cloud Deployment Context...');
      
      // Select Banking + Capital Markets
      const bankingBtn = document.querySelector('[data-industry="banking"]');
      if (bankingBtn) {
        bankingBtn.click();
        setTimeout(() => {
          const lobSelector = document.getElementById('lob-selector');
          lobSelector.value = 'capital-markets';
          lobSelector.dispatchEvent(new Event('change'));
          
          setTimeout(() => {
            // Select automation-cloud deployment
            const deploymentSelector = document.getElementById('deployment-type');
            deploymentSelector.value = 'automation-cloud';
            deploymentSelector.dispatchEvent(new Event('change'));
            
            logTest('✅ Cloud context test completed. Check resources for cloud-specific deployment notes.');
          }, 100);
        }, 100);
      }
    }

    function logTest(message) {
      const testLog = document.getElementById('test-log');
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.className = 'text-sm text-gray-700 p-2 bg-white rounded border';
      logEntry.innerHTML = `<span class="text-gray-400">[${timestamp}]</span> ${message}`;
      testLog.appendChild(logEntry);
      testLog.scrollTop = testLog.scrollHeight;
    }

    function validateResourcesDisplay() {
      const container = document.getElementById('resources-container');
      const resourceCards = container.querySelectorAll('.resource-card');
      
      logTest(`📊 Found ${resourceCards.length} resource cards displayed`);
      
      resourceCards.forEach((card, index) => {
        const title = card.querySelector('h3').textContent;
        const type = card.querySelector('.bg-orange-100').textContent;
        const hasDeploymentContext = card.querySelector('.text-orange-700');
        const hasCustomerContext = card.querySelector('.text-purple-700');
        
        logTest(`📋 Resource ${index + 1}: "${title}" (${type})${hasDeploymentContext ? ' [Deployment Context]' : ''}${hasCustomerContext ? ' [Customer Context]' : ''}`);
      });
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', () => {
      logTest('🚀 Initializing dynamic resources filtering test...');
      
      // Wait for the main app to load
      setTimeout(() => {
        if (window.customerInfoManager) {
          testManager = window.customerInfoManager;
          logTest('✅ CustomerInfoManager loaded successfully');
          logTest('✅ ResourceManager integrated');
          logTest('Ready for testing! Use the test buttons above or manually select criteria.');
          
          // Add observer for resource updates
          const observer = new MutationObserver(() => {
            setTimeout(validateResourcesDisplay, 100);
          });
          
          const container = document.getElementById('resources-container');
          if (container) {
            observer.observe(container, { childList: true, subtree: true });
          }
          
        } else {
          logTest('❌ CustomerInfoManager not found. Make sure timeline-app.js is loaded.');
        }
      }, 500);
    });
  </script>
</body>
</html>